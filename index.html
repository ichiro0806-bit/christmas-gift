<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>ğŸ„ è–èª•äº¤æ›ç¦®ç‰©ç¿»ç‰Œ</title>

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: radial-gradient(circle, #145a32, #0b3d2e);
    color: white;
    text-align: center;
    overflow: hidden;
}

/* å•Ÿå‹•ç•«é¢ */
#startScreen {
    position: fixed;
    inset: 0;
    background: #0b3d2e;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 9999;
}

#startScreen button {
    font-size: 32px;
    padding: 20px 50px;
    border-radius: 16px;
    border: none;
    background: #e74c3c;
    color: white;
}

h1 { font-size: 48px; margin-top: 40px; }

button {
    font-size: 28px;
    padding: 16px 40px;
    margin: 10px;
    border: none;
    border-radius: 14px;
    background: #e74c3c;
    color: white;
}

button.secondary { background: #2980b9; }
button.gray { background: #555; }

#countdown { font-size: 120px; color: #f1c40f; }
#card { font-size: 72px; margin-top: 30px; }
#left { font-size: 24px; opacity: 0.8; }

/* æŠ•å½±æ¨¡å¼ */
.projector h1 { font-size: 80px; }
.projector #card { font-size: 140px; }
.projector #countdown { font-size: 180px; }

/* é›ªèŠ± */
.snowflake {
    position: fixed;
    top: -10px;
    user-select: none;
    animation: fall linear infinite;
}
@keyframes fall {
    to { transform: translateY(110vh); }
}

/* è–èª•è€äºº */
#santa {
    position: fixed;
    top: 80px;
    left: -300px;
    font-size: 64px;
    animation: fly 18s linear infinite;
    pointer-events: none;
}
@keyframes fly {
    to { transform: translateX(120vw); }
}
</style>
</head>

<body>

<!-- å•Ÿå‹•ç•«é¢ -->
<div id="startScreen">
    <h1>ğŸ„ è–èª•äº¤æ›ç¦®ç‰© ğŸ„</h1>
    <button onclick="start()">ğŸ‘‰ é»æˆ‘é–‹å§‹</button>
    <p>ï¼ˆè§£é–éŸ³æ•ˆ & äº’å‹•ï¼‰</p>
</div>

<h1>ğŸ„ ç”Ÿæª¢èª²æº«é¦¨æ„Ÿäººè¡Œæ†²ç´€å¿µæ—¥äº¤æ›ç¦®ç‰© ğŸ„</h1>

<div>
    <button id="btn" onclick="draw()">ğŸ ç¿»ç‰Œ</button>
    <button class="secondary" onclick="toggleProjector()">ğŸ–¥ æŠ•å½±æ¨¡å¼</button>
    <button class="gray" onclick="resetGame()">ğŸ” é‡æ–°é–‹å§‹</button>
</div>

<div id="countdown"></div>
<div id="card"></div>
<div id="left"></div>

<div id="santa">ğŸ…ğŸ¦ŒğŸ¦ŒğŸ¦Œ</div>

<!-- ğŸµ èƒŒæ™¯éŸ³æ¨‚ -->
<audio id="bgm" src="./jb.mp3" loop preload="auto"></audio>

<!-- ğŸ”Š ç¿»ç‰ŒéŸ³æ•ˆ -->
<audio id="flipSound" src="./ass.mp3" preload="auto"></audio>
<!-- ğŸ”Š åŒæ­¥éŸ³æ•ˆ -->
<audio id="countSound" src="./ass.mp3" preload="auto"></audio>

<script>
const originalNames = [
    "æ—ä½³æ­£","ç‹ç¶­å®£","æˆ´æ†²éµ¬","å°¹å§¿èŠ³","éƒ­èŠ³å‡","å¤ç«£æ–‡","æ™‚æ·¯ç¥","æ—ç¿ å©·",
    "è—äº‘æ±","è¬å®—ç‘œ","é™³å„€å®¸","é»ƒåœ‹æº","è˜‡è‡´è±ª","ç‹å½¥æ¬½","é„­ç¿”äºˆ","é™³è‘­ç‘œ",
    "è¨±æ¡“ç¿","é™³æ™¢å‡±","å¼µè‡´å½¬","å¾è©©æ£ ","è”£æ˜‡å³°","å‡Œå¥å³°","ä½•é‡‡ç©","æ—è€è‘¶","é‡‘æ„ç­"
];

let names = [...originalNames];
let drawing = false;

/* é»æˆ‘é–‹å§‹ï¼šæ’­æ”¾èƒŒæ™¯éŸ³æ¨‚ */
function start() {
    document.getElementById("startScreen").style.display = "none";

    const bgm = document.getElementById("bgm");
    bgm.volume = 0.2;
    bgm.currentTime = 0;
    bgm.play().catch(() => {});
}

/* ç¿»ç‰Œ */
function draw() {
  const ref = db.ref();

  ref.transaction(data => {
    if (!data) return data;

    // æœ‰äººæ­£åœ¨æŠ½ or æŠ½å®Œäº†
    if (data.drawing || data.names.length === 0) return;

    // ä¸Šé– + åˆå§‹åŒ–å€’æ•¸
    data.drawing = true;
    data.current = "";
    data.countdown = 3;

    return data;
  }, () => {
    // é–‹å§‹å€’æ•¸ï¼ˆé›²ç«¯ï¼‰
    let c = 3;
    const timer = setInterval(() => {
      c--;

      if (c > 0) {
        ref.update({ countdown: c });
      } else {
        clearInterval(timer);

        ref.transaction(data => {
          if (!data || data.names.length === 0) return data;

          const idx = Math.floor(Math.random() * data.names.length);
          data.current = data.names.splice(idx, 1)[0];
          data.countdown = 0;
          data.drawing = false;

          return data;
        });
      }
    }, 1000);
  });
}


/* é‡ç½® */
function resetGame() {
    names = [...originalNames];
    document.getElementById("card").innerText = "";
    document.getElementById("left").innerText = "å·²é‡ç½® ğŸ„";
    document.getElementById("countdown").innerText = "";
    drawing = false;
}

/* æŠ•å½±æ¨¡å¼ */
function toggleProjector() {
    document.body.classList.toggle("projector");
}

/* é›ªèŠ± */
setInterval(() => {
    const s = document.createElement("div");
    s.className = "snowflake";
    s.innerText = "â„";
    s.style.left = Math.random() * window.innerWidth + "px";
    s.style.fontSize = 14 + Math.random() * 20 + "px";
    s.style.animationDuration = 5 + Math.random() * 5 + "s";
    document.body.appendChild(s);
    setTimeout(() => s.remove(), 10000);
}, 300);
</script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/* ğŸ”‘ è²¼ä¸Šä½ è‡ªå·±çš„ firebaseConfig */
const firebaseConfig = {
  apiKey: "AIzaSyBz2naDAZZP7PVSBJPKizGwCTZbVkuW0fE",
  authDomain: "christmas-3rdalc.firebaseapp.com",
  databaseURL: "https://christmas-3rdalc-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "christmas-3rdalc",
  storageBucket: "christmas-3rdalc.firebasestorage.app",
  messagingSenderId: "480438610552",
  appId: "1:480438610552:web:83397c3eb58ae9a747db8d"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
</script>
<script>
const countdownEl = document.getElementById("countdown");
const cardEl = document.getElementById("card");
const leftEl = document.getElementById("left");

/* ğŸ”„ ç›£è½é›²ç«¯ç‹€æ…‹ */
let lastCountdown = 0;
let lastName = "";

db.ref().on("value", snap => {
  const data = snap.val();
  if (!data) return;

  leftEl.innerText = "å‰©ä¸‹ " + data.names.length + " äºº";

  /* ğŸ”Š åŒæ­¥å€’æ•¸éŸ³æ•ˆ */
  if (data.countdown > 0) {
    countdownEl.innerText = data.countdown;
    cardEl.innerText = "";

    if (data.countdown !== lastCountdown) {
      const cSound = document.getElementById("countSound");
      cSound.currentTime = 0;
      cSound.volume = 0.6;
      cSound.play().catch(() => {});
      lastCountdown = data.countdown;
    }

  } else {
    countdownEl.innerText = "";
    lastCountdown = 0;

    /* ğŸ”Š åŒæ­¥ç¿»ç‰ŒéŸ³æ•ˆï¼ˆåå­—å‡ºç¾ç¬é–“ï¼‰ */
    if (data.current && data.current !== lastName) {
      cardEl.innerText = "ğŸ " + data.current;

      const flip = document.getElementById("flipSound");
      flip.currentTime = 0;
      flip.volume = 0.7;
      flip.play().catch(() => {});

      lastName = data.current;
    }
  }
});
</script>

</body>
</html>


